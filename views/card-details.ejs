<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="é€™æ˜¯ä¸€å€‹å°ˆé–€å±•ç¤ºå¡ç‰Œç¶²ç«™ï¼Œæ”¯æ´æœå°‹ã€UAä¸­æ–‡å¡è¡¨ã€çœ‹åƒ¹æ ¼èˆ‡çµ„ç‰ŒåŠŸèƒ½ã€‚">
  <meta name="keywords" content="å¡ç‰Œ, æ”¶è—, TCG, UAä¸­æ–‡å¡è¡¨, éŠæˆ², Union Arena">
  <meta name="csrf-token" content="<%= csrfToken %>">
  <meta name="series-name" content="<%= fileName %>">
  <title><%= fileName %> | æ­ªè¥¿ç‰ŒåŠ</title>
  <link rel="icon" href="/images/name.png" type="image/png">
  <link rel="stylesheet" href="/styles/card-details.css"> <!-- å¼•ç”¨å¤–éƒ¨ CSS -->
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=AW-17438354064">
  </script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'AW-17438354064');
  </script>
</head>
<body class="dark-mode">
  <div class="main-content" id="main-content">
    <h1 style="text-align: center; margin-top: 20px; color: #fff;"><%= fileName %> - å¡ç‰‡è©³ç´°è³‡æ–™</h1>
      <!-- é¸å–®æŒ‰éˆ• -->
      <div class="menu-buttons">
        <button class="menu-button" id="toggle-menu-btn">â˜° ç‰Œçµ„è£½ä½œ</button>
        <button class="menu-button" id="toggle-filters-btn">â˜° ç¯©é¸åŠŸèƒ½</button>
        <button class="menu-button" id="toggle-translation-btn">é¡¯ç¤ºä¸­æ–‡</button>
        <button class="menu-button" id="draw-pack-btn">ğŸ² æŠ½ç³»åˆ—å¡åŒ…</button>
        <button class="menu-button" id="go-to-series-btn">å›åˆ°é¸æ“‡ç³»åˆ—</button>
        <button class="menu-button" id="view-decks-btn">æœå°‹å¡çµ„</button>
      </div>
        <div class="card-container" id="card-container">
          <%
            // å–å¾—é¡è‰²æœ¬é«”
            function getColorBase(str) {
              return str && str.match(/[è—ç´…é»ƒç¶ ç´«]/) ? str.match(/[è—ç´…é»ƒç¶ ç´«]/)[0] : str;
            }
          %>
          <% cards.forEach((card, index) => { %>
            <div class="card" 
                data-index="card-<%= index %>"
                data-card-number="<%= card.card_number %>"
                data-rarity="<%= card.rare || 'ç„¡' %>" 
                data-color="<%= card.details['å¿…è¦ã‚¨ãƒŠã‚¸ãƒ¼'] ? card.details['å¿…è¦ã‚¨ãƒŠã‚¸ãƒ¼'].replace(/[0-9]/g, '').replace('é’', 'è—').replace('èµ¤', 'ç´…').replace('ç·‘', 'ç¶ ').replace('é»„', 'é»ƒ').replace(/[-]/g, '') : 'ç„¡' %>" 
                data-energy="<%= card.details['å¿…è¦ã‚¨ãƒŠã‚¸ãƒ¼'] ? card.details['å¿…è¦ã‚¨ãƒŠã‚¸ãƒ¼'].replace(/[^0-9]/g, '') || '0' : '0' %>" 
                data-type="<%= card.details['trã‚«ãƒ¼ãƒ‰ç¨®é¡'] || '' %>"
                data-ap="<%= card.details['AP'] ? card.details['AP'].replace(/[^0-9]/g, '') || '0' : '0' %>">
              <p><%= card.card_number %></p>
              <img src="<%= card.image_url %>" alt="<%= card.card_name %>">
              <h2><%= card.card_name %></h2>
              <span class="card-count-indicator" id="card-count-<%= index %>">0</span>
              <div style="display: flex; justify-content: center; align-items: center; flex-direction: column; margin-bottom: 10px;">
                <p>
                  ç¨€æœ‰åº¦: <%= card.rare %> || é¡è‰²: 
                  <%
                    let colorStrRaw = card.details["å¿…è¦ã‚¨ãƒŠã‚¸ãƒ¼"] 
                      ? card.details["å¿…è¦ã‚¨ãƒŠã‚¸ãƒ¼"]
                          .replace(/[0-9]/g, '')
                          .replace('é’', 'è—')
                          .replace('èµ¤', 'ç´…')
                          .replace('ç·‘', 'ç¶ ')
                          .replace('é»„', 'é»ƒ')
                          .replace(/[-]/g, '')
                      : 'ç„¡';
                    let colorArrRaw = colorStrRaw.split(/[ï¼\/]/).filter(c => c && c !== 'ç„¡');
                  %>
                  <% if (colorArrRaw.length > 0) { %>
                    <% colorArrRaw.forEach(function(c, idx) { %>
                      <span class="color-text" data-color="<%= getColorBase(c) %>"><%= c %></span><%= idx < colorArrRaw.length-1 ? 'ï¼' : '' %>
                    <% }) %>
                  <% } else { %>
                    ç„¡
                  <% } %>
                </p>
              </div>
              <div style="display: flex; justify-content: center; align-items: center; flex-direction: column; margin-bottom: 10px;">
                <p>
                  ç”¢ç”Ÿ: 
                  <%
                    let genStrRaw = card.details["ç™ºç”Ÿã‚¨ãƒŠã‚¸ãƒ¼"] 
                      ? card.details["ç™ºç”Ÿã‚¨ãƒŠã‚¸ãƒ¼"]
                          .replace('é’', 'è—')
                          .replace('èµ¤', 'ç´…')
                          .replace('ç·‘', 'ç¶ ')
                          .replace('é»„', 'é»ƒ')
                          .replace(/[-]/g, '')
                      : 'ç„¡';
                    let genArrRaw = genStrRaw.split(/[ï¼\/]/).filter(c => c && c !== 'ç„¡');
                  %>
                  <% if (genArrRaw.length > 0) { %>
                    <% genArrRaw.forEach(function(c, idx) { %>
                      <span class="color-text" data-color="<%= getColorBase(c) %>"><%= c %></span><%= idx < genArrRaw.length-1 ? 'ï¼' : '' %>
                    <% }) %>
                  <% } else { %>
                    ç„¡
                  <% } %>
                  || åƒ¹æ ¼: <%= card.money || 'ç„¡åƒ¹æ ¼è³‡æ–™' %>
                </p>
              </div>
              <button class="add-to-deck-btn" data-index="<%= index %>">+</button>
              <button class="remove-from-deck-btn" data-index="<%= index %>">-</button>
            </div>
          <% }) %>
    </div>
  </div>
  <!-- å´é‚Šé¸å–® -->
    <div class="side-menu" id="side-menu">
      <button class="close-btn" id="close-menu-btn">Ã—</button>
      <h2>ç‰Œçµ„è£½ä½œ</h2>
      <p>å·²é¸æ“‡ <span id="deck-count">0</span> å¼µå¡ç‰‡</p>
      <p id="total-price">ç¸½åƒ¹æ ¼: 0 æ—¥å…ƒ</p> <!-- æ–°å¢ç¸½åƒ¹æ ¼é¡¯ç¤º -->
      <div style="display: flex; gap: 10px; margin-bottom: 10px;">
        <button id="sort-energy-btn" style="padding: 5px 10px; border-radius: 5px; background: #007bff; color: #fff;">ä¾å¿…è¦èƒ½é‡æ’åº</button>
        <button id="sort-original-btn" style="padding: 5px 10px; border-radius: 5px; background: #444; color: #fff;">ä¾åŠ å…¥é †åº</button>
      </div>
      <div id="deck-container" class="deck-container">
        <!-- å‹•æ…‹æ’å…¥å¡ç‰‡ -->
      </div>
      <div class="deck-controls" style="position: absolute; bottom: 20px; right: 20px; display: flex; flex-direction: column; gap: 10px; width: 100%; max-width: 360px;">
        <!-- é»ƒè‰²æ¡†ï¼šç‰Œçµ„åç¨± -->
        <input id="deck-name-input" type="text" placeholder="è¼¸å…¥ç‰Œçµ„åç¨±(ä¸è¶…é8å­—)" 
               style="padding: 5px; font-size: 16px; border-radius: 5px; border: 1px solid #ccc; width: 100%;">
      
        <!-- ç¶ è‰²æ¡†å’ŒæŒ‰éˆ• -->
        <div style="display: flex; align-items: flex-start; gap: 10px;">
          <!-- ç¶ è‰²æ¡†ï¼šæ€è·¯åˆ†äº« -->
          <textarea id="deck-idea-input" placeholder="è¼¸å…¥æ€è·¯åˆ†äº« (å¯ç‚ºç©º)" 
                    style="padding: 5px; font-size: 16px; border-radius: 5px; border: 1px solid #ccc; height: 100px; flex: 1;"></textarea>
      
          <!-- æŒ‰éˆ• -->
          <div style="display: flex; flex-direction: column; gap: 10px;">
            <!-- å‰µå»ºç‰Œçµ„æŒ‰éˆ• -->
            <button style="background-color: #007bff; color: #fff; padding: 10px 15px; border-radius: 5px; width: 100px;" id="save-deck-btn">å‰µå»ºç‰Œçµ„</button>
            
            <!-- ä¸€éµåˆªé™¤æŒ‰éˆ• -->
            <button style="background-color: #ff5c5c; color: #fff; padding: 10px 15px; border-radius: 5px; width: 100px;" id="clear-deck-btn">ä¸€éµåˆªé™¤</button>
            <div id="card-modal" class="modal"></div>
          </div>
        </div>
      </div>
  <!-- ç¯©é¸è¡¨å–® -->
  <div id="overlay" class="hidden" ></div> <!-- é®ç½©å±¤ -->
    <div class="filter-container" id="filter-container">
      <div style="margin-top: 1px; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
        <input
          type="text"
          id="character-search-input"
          placeholder="è¼¸å…¥è§’è‰²åç¨±æœå°‹"
          style="width: 140px; padding: 5px; font-size: 15px; border-radius: 5px; border: 1px solid #ccc;"
        >
        <button
          id="character-search-btn"
          style="padding: 5px 12px; font-size: 15px; border-radius: 5px; margin-left: 0; background: #007bff; color: #fff; border: none;"
        >æœå°‹</button>
      </div>
      <button class="close-btn" id="close-filters-btn">Ã—</button> <!-- æ–°å¢é—œé–‰æŒ‰éˆ• -->
      <h3>ç¨€æœ‰åº¦</h3>
      <hr>
      <div class="filter-buttons" id="rarity-buttons">
        <button class="filter-btn" data-type="rarity" data-value="U">U</button>
        <button class="filter-btn" data-type="rarity" data-value="C">C</button>
        <button class="filter-btn" data-type="rarity" data-value="R">R</button>
        <button class="filter-btn" data-type="rarity" data-value="SR">SR</button>
        <button class="filter-btn" data-type="rarity" data-value="AP">ç‰¹æ®Š</button>
      </div>
      <h3>å¡çš„ç¨®é¡</h3>
      <hr>
      <div class="filter-buttons" id="type-buttons">
        <button class="filter-btn" data-type="type" data-value="è§’è‰²">è§’è‰²</button>
        <button class="filter-btn" data-type="type" data-value="äº‹ä»¶">äº‹ä»¶</button>
        <button class="filter-btn" data-type="type" data-value="å ´åœ°">å ´åœ°</button>
        <button class="filter-btn" data-type="type" data-value="é çµ„">é çµ„</button> <!-- æ–°å¢é çµ„ -->
        <button class="filter-btn" data-type="type" data-value="è£œå……åŒ…">è£œå……åŒ…</button> <!-- æ–°å¢è£œå……åŒ… -->
      </div>
      <h3>é¡è‰²</h3>
      <hr>
      <div class="filter-buttons" id="color-buttons">
        <button class="filter-btn" data-type="color" data-value="ç¶ ">ç¶ è‰²</button>
        <button class="filter-btn" data-type="color" data-value="é»ƒ">é»ƒè‰²</button>
        <button class="filter-btn" data-type="color" data-value="ç´…">ç´…è‰²</button>
        <button class="filter-btn" data-type="color" data-value="è—">è—è‰²</button>
        <button class="filter-btn" data-type="color" data-value="ç´«">ç´«è‰²</button>
        <button class="filter-btn" data-type="color" data-value="">å…¨éƒ¨</button>
      </div>
      <h3>å¿…è¦èƒ½é‡</h3>
      <hr>
      <div class="filter-buttons" id="energy-buttons">
        <% for (let i = 0; i <=17 ; i++) { %>
          <button class="filter-btn" data-type="energy" data-value="<%= i %>"><%= i %></button>
        <% } %>
      </div>

      <h3>AP</h3>
      <hr>
      <div class="filter-buttons" id="ap-buttons">
        <% for (let i = 1; i <= 3; i++) { %>
          <button class="filter-btn" data-type="ap" data-value="<%= i %>"><%= i %></button>
        <% } %>
      </div>
    </div>

    <!-- å›åˆ°æœ€ä¸ŠæŒ‰éˆ• -->
  <button id="back-to-top-btn" style="
    position: fixed;
    bottom: 20px;
    right: 20px;
    background-color: #007bff;
    color: #fff;
    border: none;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    font-size: 20px;
    text-align: center;
    cursor: pointer;
    display: none; /* é è¨­éš±è— */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    z-index: 1000;
  ">â†‘</button>
  <!-- å¡ç‰‡è©³ç´°å…§å®¹å½ˆå‡ºæ¡† -->
  <div id="card-modal" class="modal"></div>
    <script id="card-data" type="application/json">
    <%- JSON.stringify(cards) %>
    </script>
  <script src="/scripts/card-details.js"></script>
</body>
</html>